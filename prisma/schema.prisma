// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// Admin user model
model Admin {
  id           String    @id @default(cuid())
  email        String    @unique
  passwordHash String
  name         String
  createdAt    DateTime  @default(now())
  sessions     Session[]

  @@map("admins")
}

// Session model for JWT token management
model Session {
  id        String   @id @default(cuid())
  adminId   String
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())
  admin     Admin    @relation(fields: [adminId], references: [id], onDelete: Cascade)

  @@index([adminId])
  @@map("sessions")
}

// Partner model (Institutional, International, Sponsors)
model Partner {
  id           String   @id @default(cuid())
  name         String
  description  String?  @db.Text // Scurtă descriere a partenerului
  logoUrl      String
  type         String   // "institutional" | "international" | "sponsor"
  websiteUrl   String?
  displayOrder Int      @default(0)
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([type])
  @@index([displayOrder])
  @@map("partners")
}

// Project model (Research projects)
model Project {
  id                    String    @id @default(cuid())
  title                 String
  shortDescription      String    @db.Text // Scurtă descriere pentru card
  detailedDescription   String?   @db.Text // Descriere completă cu HTML (rich text)
  status                String?   // "ongoing" | "completed"
  startDate             DateTime? // Data de început
  endDate               DateTime? // Data de finalizare
  isActive              Boolean   @default(true)
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  @@index([status])
  @@map("projects")
}

// Event model (Conferences, meetings, etc.)
model Event {
  id                  String              @id @default(cuid())
  title               String
  type                String?             // "conference" | "meeting" | "workshop" | "seminar" | "other"
  shortDescription    String?             @db.Text // Scurtă descriere pentru card
  detailedDescription String?             @db.Text // Descriere completă cu HTML (rich text) - include comitete, program, locație, etc.
  imageUrl            String?             // Imagine pentru eveniment
  eventDate           DateTime?           // Data evenimentului (opțional)
  isActive            Boolean             @default(true)
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt
  registrations       EventRegistration[]

  @@index([eventDate])
  @@map("events")
}

// Event registration model (optional - for tracking registrations)
model EventRegistration {
  id        String   @id @default(cuid())
  eventId   String
  name      String
  email     String
  createdAt DateTime @default(now())
  event     Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@index([eventId])
  @@map("event_registrations")
}

// Resource model (Guides and articles)
model Resource {
  id          String         @id @default(cuid())
  title       String
  description String         @db.Text
  url         String?        // External URL (optional)
  type        String         // "guide" | "article" | "document"
  isActive    Boolean        @default(true)
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  files       ResourceFile[] // Multiple files can be attached

  @@index([type])
  @@map("resources")
}

// Resource files (multiple files per resource)
model ResourceFile {
  id         String   @id @default(cuid())
  resourceId String
  fileName   String   // Original file name
  fileUrl    String   // Path to uploaded file
  fileSize   Int      // File size in bytes
  mimeType   String   // MIME type of the file
  createdAt  DateTime @default(now())
  resource   Resource @relation(fields: [resourceId], references: [id], onDelete: Cascade)

  @@index([resourceId])
  @@map("resource_files")
}

// Contact submission model (Contact form submissions)
model ContactSubmission {
  id        String   @id @default(cuid())
  name      String
  email     String
  subject   String
  message   String   @db.Text
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())

  @@index([isRead])
  @@index([createdAt])
  @@map("contact_submissions")
}

// Membership application model (SCIPI membership applications)
model MembershipApplication {
  id                      String   @id @default(cuid())
  firstName               String
  lastName                String
  email                   String
  professionalGrade       String   // "medic_rezident" | "medic_specialist" | "medic_primar" | "student_medicina" | "asistent_medical" | "alta"
  otherProfessionalGrade  String?  // Filled if professionalGrade is "alta"
  medicalSpecialty        String
  academicDegree          String?  // Grad didactic
  institutionalAffiliation String
  membershipType          String   // "membru_activ" | "medic_asociat"
  researchInterests       String   @db.Text
  gdprConsent             Boolean  @default(false)
  feeConsent              Boolean  @default(false)
  newsletterConsent       Boolean  @default(false)
  status                  String   @default("pending") // "pending" | "approved" | "rejected"
  reviewedAt              DateTime?
  reviewNotes             String?  @db.Text
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  @@index([status])
  @@index([createdAt])
  @@index([email])
  @@map("membership_applications")
}
